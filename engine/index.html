<!DOCTYPE html>

<meta charset="UTF-8">

<html lang="en">

    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
    
        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    

        <script id="vertex-shader" type="x-shader/x-vertex">
            #version 300 es
    
            in vec4 aPosition;
            in vec2 aTexCoord;
    
            in vec3 aNormal;
            in vec3 aTangent;
    
            out vec4 vColor;
            out vec2 vTexCoord;
    
            out vec3 L;
            out vec3 E;
            out vec3 N;
    
            out mat3 sys;
    
    
            uniform mat4 uModelViewMatrix;
            uniform mat4 uProjectionMatrix;
            uniform mat4 uCameraViewMatrix;
    
            uniform mat3 uNormalMatrix;
            uniform vec4 uLightPosition;
    
    
            uniform float uTextureMode;
    
    
            void main()
            {
    
                vTexCoord = aTexCoord;
                gl_Position = uProjectionMatrix * uCameraViewMatrix *  uModelViewMatrix * aPosition;
        
                vec3 pos = -(uModelViewMatrix * aPosition).xyz;
                L = normalize(uLightPosition.xyz - pos);
                E = normalize(-pos);
                N = normalize((uModelViewMatrix * vec4(aNormal,0)).xyz);
    
                vec3 bitangent = cross(aNormal, aTangent);
                sys = mat3(aTangent, bitangent, aNormal);
    
    
            }
            </script>
    
        <script id="fragment-shader" type="x-shader/x-fragment">
        #version 300 es

        precision mediump float;

        in vec2 vTexCoord;
        in vec3 N, L, E;
        in mat3 sys; // coordinate system

        out vec4 fColor;

        uniform sampler2D uTextureMap;
        uniform sampler2D uNormalMap;

        uniform highp mat4 uModelViewMatrix;
        uniform vec4 uLightColor;
        uniform vec4 uMaterialColor;
        uniform highp float uTextureMode;

        vec3 NN;

        void main()
        {

            vec4 normal = 2.0 * texture(uNormalMap, vTexCoord) - 1.0;


            if(uTextureMode > 0.6) NN = normalize(uModelViewMatrix * vec4(sys * normal.xyz, 0.0)).xyz;
            else NN = N;

            vec3 H = normalize(L + E);

            vec4 ambient = uMaterialColor * uLightColor;

            float Kd = max(dot(L, NN), 0.0);
            vec4  diffuse = Kd * uMaterialColor * uLightColor;

            float Ks = pow(max(dot(NN, H), 0.0), 100.0);
            vec4  specular = Ks * uMaterialColor * uLightColor;

            if( dot(L, NN) < 0.0 ) specular = vec4(0.0, 0.0, 0.0, 1.0);

            vec4 color = ambient + diffuse + specular;
            color.a = 1.0;
    
            if(uTextureMode > 0.3) fColor = color * texture(uTextureMap, vTexCoord);
            else fColor = color;

        }
        </script>
    
        <script type="text/javascript" src="../Common/initShaders.js"></script>
        <script type="text/javascript" src="../Common/MVnew.js"></script>
        <script type="text/javascript" src="index.js"></script>
    
        <title>Hello, world!</title>
      </head>
    



<body>
        <div class="container">
            <div class="row">
                <!-- 1280 x 720 -->
                <canvas id="gl-canvas" width="1280" height="720" style="border-style: solid; border-color: coral;">
                    Oops ... your browser doesn't support the HTML5 canvas element
                </canvas>

            </div>
        </div>


    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    -->

</body>
</html>
